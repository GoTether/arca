<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arca Viewer</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Vue.js CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Browser Image Compression -->
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
  <!-- Custom Styles for Luxury Theme -->
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #F9FAFB; /* Light gray-blue for clean luxury */
      color: #0F172A; /* Dark slate text */
      margin: 0;
    }
    header {
      background: linear-gradient(90deg, #1D4ED8 0%, #3B82F6 100%); /* Deep blue gradient */
      color: #FFFFFF;
      padding: 1em 2em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 12px rgba(29, 78, 216, 0.2);
    }
    main {
      max-width: 1200px;
      margin: 2em auto;
      padding: 0 1em;
    }
    .item-card {
      cursor: pointer;
      transition: transform 0.2s;
    }
    .item-card:hover {
      transform: scale(1.05);
    }
    .item-quantity {
      background: rgba(31, 41, 55, 0.8); /* Semi-transparent dark gray */
      color: #FFFFFF;
    }
    .fab {
      background: linear-gradient(90deg, #1D4ED8 0%, #3B82F6 100%);
      color: #FFFFFF;
      box-shadow: 0 4px 12px rgba(29, 78, 216, 0.3);
      transition: background 0.2s;
    }
    .fab:hover {
      background: linear-gradient(90deg, #3B82F6 0%, #1D4ED8 100%);
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
      backdrop-filter: blur(4px); /* Subtle blur for luxury */
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal {
      background: #FFFFFF;
      box-shadow: 0 4px 24px rgba(15, 23, 42, 0.2);
      border-radius: 12px;
      max-width: 90vw;
      width: 448px; /* max-w-md equivalent */
      max-height: 80vh;
      overflow-y: auto;
      padding: 1.5rem;
      animation: modalFadeIn 0.3s ease-out;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    button {
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 1em;
    }
    #toast {
      background: linear-gradient(90deg, #1D4ED8 0%, #3B82F6 100%);
      color: #FFFFFF;
      box-shadow: 0 2px 12px rgba(29, 78, 216, 0.2);
    }
    .context-menu {
      background: #FFFFFF;
      box-shadow: 0 2px 12px rgba(15, 23, 42, 0.1);
      border-radius: 8px;
    }
    .gold-accent {
      color: #D4AF37; /* Subtle gold for highlights */
    }
    .tooltip {
      background: #1D4ED8;
      color: #FFFFFF;
      padding: 0.5em 1em;
      border-radius: 8px;
      position: absolute;
      z-index: 100;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1 class="text-2xl font-bold">Arca Viewer</h1>
      <div v-if="user" class="text-sm">{{ user.email }}</div>
      <button @click="goToDashboard" class="bg-white text-[#1D4ED8] px-4 py-2 rounded-md font-bold">Dashboard</button>
    </header>
    <main>
      <!-- Arca Details -->
      <section v-if="arca" class="mb-8">
        <div class="flex items-start gap-4">
          <img v-if="arca.image" :src="arca.image" class="w-32 h-32 rounded-xl object-cover border-2 border-[#3B82F6] shadow-md" alt="Arca Image" />
          <div>
            <h2 class="text-3xl font-bold text-[#1D4ED8]">{{ arca.name }}</h2>
            <span class="text-lg text-[#3B82F6]">{{ arca.type }} - {{ arca.location }}</span>
            <p class="italic text-[#D4AF37]">{{ arca.note }}</p>
            <div class="mt-2">
              <span class="font-mono bg-[#E5E7EB] p-1 rounded">ID: {{ arcaId }}</span>
              <span class="bg-gradient-to-r from-[#1D4ED8] to-[#3B82F6] text-white px-3 py-1 rounded-full ml-2">{{ totalItems }} items</span>
              <button @click="openArcaModal" class="ml-2 text-[#D4AF37]"><i class="material-icons">edit</i></button>
            </div>
          </div>
        </div>
      </section>
      <!-- Items Section -->
      <section v-if="arca">
        <div class="flex justify-between mb-4">
          <h3 class="text-2xl font-bold text-[#1D4ED8]">Items</h3>
          <input v-model="searchQuery" placeholder="Search items..." class="p-2 border rounded-md" style="font-family: 'Segoe UI', sans-serif;" />
        </div>
        <div id="itemsList" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 relative">
          <div v-for="(item, id) in filteredItems" :key="id" class="item-card flex flex-col items-center" 
               @click="openItemModal(true, id)" @contextmenu.prevent="showContextMenu($event, id)" :aria-label="`Edit item ${item.name}`">
            <div class="relative">
              <img v-if="item.image" :src="item.image" class="w-32 h-32 md:w-40 md:h-40 rounded-md object-cover border border-gray-200" alt="Item Image" />
              <div v-else class="w-32 h-32 md:w-40 md:h-40 bg-gray-200 rounded-md flex items-center justify-center">
                <i class="material-icons text-gray-400">image</i>
              </div>
              <span v-if="item.quantity > 1" class="item-quantity absolute top-1 right-1 text-xs px-2 py-1 rounded-full">
                {{ item.quantity }}
              </span>
            </div>
            <div class="truncate mt-2 text-base font-bold text-[#1D4ED8]" style="font-family: 'Segoe UI', sans-serif;">
              {{ item.name }}
            </div>
          </div>
          <div v-if="showTooltip" class="tooltip" :style="{ top: '50px', left: '50%', transform: 'translateX(-50%)' }">
            {{ isMobile ? 'Tap to edit items' : 'Click to edit items' }}
          </div>
        </div>
        <button v-if="arca" @click="openItemModal(false)" class="fab fixed bottom-6 right-6 rounded-full p-4 shadow-xl">
          <i class="material-icons text-2xl">add</i>
        </button>
      </section>
      <!-- Item Modal -->
      <div v-if="showItemModal" class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="itemModalTitle">
          <form @submit.prevent="saveItem">
            <h3 id="itemModalTitle" class="text-xl font-bold text-[#1D4ED8]" style="font-family: 'Segoe UI', sans-serif;">{{ isEditingItem ? 'Edit Item' : 'Add Item' }}</h3>
            <div v-if="itemForm.image" class="mb-4">
              <img :src="itemForm.image" class="w-full max-h-24 object-cover rounded-md" alt="Item Image" />
              <button type="button" @click="itemForm.image = null; itemModalDeleteImage = true" class="text-red-500 text-sm mt-1" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Remove Image</button>
            </div>
            <button type="button" @click="openImageOptions('item')" class="text-[#D4AF37] mb-4" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">
              {{ itemForm.image ? 'Replace Image' : 'Add Image' }}
            </button>
            <input type="file" id="itemFileInput" accept="image/*" style="display:none" @change="handleItemFileChange">
            <label class="block mb-2">
              Name
              <input v-model="itemForm.name" required class="w-full p-2 border rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;" />
            </label>
            <label class="block mb-2">
              Note
              <input v-model="itemForm.note" class="w-full p-2 border rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;" />
            </label>
            <label class="block mb-2">
              Hashtags
              <input v-model="hashtagsInput" placeholder="tag1, tag2" class="w-full p-2 border rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;" />
            </label>
            <label class="block mb-2">
              Quantity
              <input v-model.number="itemForm.quantity" type="number" min="0" class="w-full p-2 border rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;" />
            </label>
            <div class="flex gap-2 justify-end">
              <button type="button" @click="closeItemModal" class="px-4 py-2 bg-gray-200 rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Cancel</button>
              <button type="submit" class="px-4 py-2 bg-[#1D4ED8] text-white rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Save</button>
              <button v-if="isEditingItem" type="button" @click="deleteItem" class="px-4 py-2 bg-red-500 text-white rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Delete</button>
            </div>
          </form>
        </div>
      </div>
      <!-- Arca Modal -->
      <div v-if="showArcaModal" class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="arcaModalTitle">
          <form @submit.prevent="saveArca">
            <h3 id="arcaModalTitle" class="text-xl font-bold text-[#1D4ED8]" style="font-family: 'Segoe UI', sans-serif;">Edit Arca</h3>
            <div v-if="arcaForm.image" class="mb-4">
              <img :src="arcaForm.image" class="w-full max-h-24 object-cover rounded-md" alt="Arca Image" />
              <button type="button" @click="arcaForm.image = null; arcaModalDeleteImage = true" class="text-red-500 text-sm mt-1" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Remove Image</button>
            </div>
            <button type="button" @click="openImageOptions('arca')" class="text-[#D4AF37] mb-4" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">
              {{ arcaForm.image ? 'Replace Image' : 'Add Image' }}
            </button>
            <input type="file" id="arcaFileInput" accept="image/*" style="display:none" @change="handleArcaFileChange">
            <label class="block mb-2">
              Name
              <input v-model="arcaForm.name" required class="w-full p-2 border rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;" />
            </label>
            <label class="block mb-2">
              Type
              <input v-model="arcaForm.type" class="w-full p-2 border rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;" />
            </label>
            <label class="block mb-2">
              Location
              <input v-model="arcaForm.location" class="w-full p-2 border rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;" />
            </label>
            <label class="block mb-2">
              Note
              <input v-model="arcaForm.note" class="w-full p-2 border rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;" />
            </label>
            <div class="flex gap-2 justify-end">
              <button type="button" @click="showArcaModal = false" class="px-4 py-2 bg-gray-200 rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Cancel</button>
              <button type="submit" class="px-4 py-2 bg-[#1D4ED8] text-white rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Save</button>
            </div>
          </form>
        </div>
      </div>
      <!-- Image Options Modal -->
      <div v-if="showImageOptions" class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="imageOptionsTitle">
          <h3 id="imageOptionsTitle" class="text-xl font-bold text-[#1D4ED8]" style="font-family: 'Segoe UI', sans-serif;">Choose Image Source</h3>
          <button @click="takePhoto" class="block w-full px-4 py-2 mb-2 bg-gray-100 rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Take a Photo</button>
          <button @click="uploadPhoto" class="block w-full px-4 py-2 mb-2 bg-gray-100 rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Upload a Photo</button>
          <button @click="chooseFromLibrary" class="block w-full px-4 py-2 mb-2 bg-gray-100 rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Choose from Library</button>
          <button @click="showImageOptions = false" class="block w-full px-4 py-2 bg-gray-200 rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Cancel</button>
        </div>
      </div>
      <!-- Existing Images Modal -->
      <div v-if="showExistingImages" class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="libraryModalTitle">
          <h3 id="libraryModalTitle" class="text-xl font-bold text-[#1D4ED8]" style="font-family: 'Segoe UI', sans-serif;">Choose from Library</h3>
          <div class="grid grid-cols-3 gap-2 mb-4">
            <img v-for="img in libraryImages" :key="img" :src="img" class="w-full h-24 object-cover rounded-md cursor-pointer" @click="selectLibraryImage(img)" :aria-label="`Select image ${img}`" />
          </div>
          <button @click="showExistingImages = false" class="px-4 py-2 bg-gray-200 rounded" style="font-family: 'Segoe UI', sans-serif; font-size: 1em;">Cancel</button>
        </div>
      </div>
      <!-- Context Menu -->
      <div v-if="contextMenu.show" class="context-menu absolute py-2" :style="{ top: contextMenu.y + 'px', left: contextMenu.x + 'px' }">
        <button @click="openItemModal(true, contextMenu.itemId)" class="block px-4 py-2 text-[#1D4ED8] hover:bg-gray-100">Edit</button>
        <button @click="deleteItem(contextMenu.itemId)" class="block px-4 py-2 text-red-600 hover:bg-gray-100">Delete</button>
      </div>
      <!-- Toast -->
      <div v-if="toast.show" id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded flex gap-2 items-center">
        {{ toast.message }}
        <button v-if="toast.undo" @click="toast.undo(); toast.show = false" class="underline text-white">Undo</button>
      </div>
    </main>
  </div>
  <script type="module" src="js/app.js"></script>
</body>
</html>
